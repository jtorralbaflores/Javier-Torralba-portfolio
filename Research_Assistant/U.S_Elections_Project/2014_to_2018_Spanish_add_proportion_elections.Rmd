---
title: "Data visualizations for 2014-2018 House, Senate and Presidential elections in the U.S for the proportion of Spanish ads"
author: "Javier Torralba"
date: "2023-04-25"
output:
  html_document:
    df_print: paged
---
```{r setup, include=TRUE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = TRUE)
```

###  Loading libraries
```{r}
library(haven)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(rjson)
library(rgdal)
library(rgeos)
library(maptools)
```
### Loading data
```{r}
wmp_house_2014_v1_0 <- read_dta("wmp-house-2014-v1.0/wmp-house-2014-v1.0.dta")
wmp_senate_2014_v1_0 <- read_dta("wmp-senate-2014-v1.0/wmp-senate-2014-v1.0.dta")
```

### Preparing map data
```{r}
neil <- readOGR("nielsen-dma-master/nielsentopo.json", "nielsen_dma", stringsAsFactors=FALSE, 
                verbose=FALSE)

neil <- SpatialPolygonsDataFrame(gBuffer(neil, byid=TRUE, width=0),
                                  data=neil@data)

neil_map <- fortify(neil, region="id")
neil_map <- neil_map %>% 
  rename(dma = id)
neil_map$dma <- as.numeric(neil_map$dma)
```
Removing unnecessary data
```{r}
rm(neil)
```


### Preparing 2014 House election data
```{r}
# Select only relevant columns
dma_and_spanish <- wmp_house_2014_v1_0 %>% 
  select(dma, spanish, affiliation)

# Proportion per dma and party
dma_and_spanish <- dma_and_spanish %>% 
  group_by(dma, affiliation) %>%
  summarise(prop_spanish = mean(spanish))
```

### Merging map data and 2014 House election data
```{r}
house_election_2014 <- left_join(neil_map, dma_and_spanish, by = "dma")

house_election_2014 <- house_election_2014 %>% filter(affiliation %in% c("DEMOCRAT", "REPUBLICAN"))
```
Removing data
```{r}
rm(dma_and_spanish, wmp_house_2014_v1_0)
```


# Proportion of spanish adds for House elections 2014 per DMA
```{r}
house_election_2014_plot <- ggplot(house_election_2014, aes(x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = prop_spanish), color = "black", size = 0.1) +
  scale_fill_gradient(name = "Gradient value", low = "white", high = "darkblue", na.value = "grey") +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        rect = element_blank()) +
  labs(title = "Proportion of spanish adds for House elections 2014 per DMA") +
  facet_wrap(~affiliation) +
  coord_fixed(1.3)
```

Saving plot
```{r}
ggsave("visualizations/house_election_2014_plot.png", plot = house_election_2014_plot, height = 4, width = 6, dpi = 300)
```


Removing unnecessary data
```{r}
rm(house_election_2014)
```

### Preparing for Senate data
```{r}
# Select only relevant columns
dma_and_spanish <- wmp_senate_2014_v1_0 %>% 
  select(dma, spanish, affiliation)

# Proportion per dma and party
dma_and_spanish <- dma_and_spanish %>% 
  group_by(dma, affiliation) %>%
  summarise(prop_spanish = mean(spanish))
```
### Merging map data and 2014 Senate election data
```{r}
senate_election_2014 <- left_join(neil_map, dma_and_spanish, by = "dma")

senate_election_2014 <- senate_election_2014 %>% filter(affiliation %in% c("DEMOCRAT", "REPUBLICAN"))

```

# "Proportion of spanish adds for Senate elections 2014 per DMA"
```{r}
senate_election_2014_plot<- ggplot(senate_election_2014, aes(x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = prop_spanish), color = "black", size = 0.1) +
  scale_fill_gradient(name = "Gradient value", low = "white", high = "darkblue", na.value = "grey") +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        rect = element_blank()) +
  labs(title = "Proportion of spanish adds for Senate elections 2014 per DMA") + 
  facet_wrap(~affiliation) +
  coord_fixed(1.3)
```

```{r}
ggsave("visualizations/senate_election_2014_plot.png", plot = senate_election_2014_plot, height = 4, width = 6, dpi = 300)
```


Removing data
```{r}
rm(dma_and_spanish, senate_election_2014, wmp_senate_2014_v1_0)
```

### Loading 2016 (non presidential) election results
```{r}
wmp_house_2016_v1_0 <- read_dta("../2016 election data (non presidential)/wmp-house-2016-v1.0/wmp-house-2016-v1.0.dta")
wmp_senate_2016_v1_0 <- read_dta("../2016 election data (non presidential)/wmp-senate-2016-v1.0/wmp-senate-2016-v1.0.dta")
```

### Preparing for House data
```{r}
# Select only relevant columns
dma_and_spanish <- wmp_house_2016_v1_0 %>% 
  select(dma, spanish, party)

# Proportion per dma and party
dma_and_spanish <- dma_and_spanish %>% 
  group_by(dma, party) %>%
  summarise(prop_spanish = mean(spanish))
```

### Merging map data and 2016 house election data
```{r}
house_election_2016 <- left_join(neil_map, dma_and_spanish, by = "dma")

house_election_2016 <- house_election_2016 %>% filter(party %in% c("DEMOCRAT", "REPUBLICAN"))

```

# Proportion of spanish adds for House elections 2016 per DMA 
```{r}
house_election_2016_plot <- ggplot(house_election_2016, aes(x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = prop_spanish), color = "black", size = 0.1) +
  scale_fill_gradient(name = "Gradient value", low = "white", high = "darkblue", na.value = "grey") +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        rect = element_blank()) +
  labs(title = "Proportion of spanish adds for House elections 2016 per DMA") + 
  facet_wrap(~party) +
  coord_fixed(1.3)
```

```{r}
ggsave("visualizations/house_election_2016_plot.png", plot = house_election_2016_plot, height = 4, width = 6, dpi = 300)
```

Removing data
```{r}
rm(dma_and_spanish, house_electio_2016, house_election_2016, wmp_house_2016_v1_0)
```


### Preparing for House data
```{r}
# Select only relevant columns
dma_and_spanish <- wmp_senate_2016_v1_0 %>% 
  select(dma, spanish, party)

# Proportion per dma and party
dma_and_spanish <- dma_and_spanish %>% 
  group_by(dma, party) %>%
  summarise(prop_spanish = mean(spanish))
```

### Merging map data and 2016 house election data
```{r}
senate_election_2016 <- left_join(neil_map, dma_and_spanish, by = "dma")

senate_election_2016 <- senate_election_2016 %>% filter(party %in% c("DEMOCRAT", "REPUBLICAN"))

```

# Proportion of spanish adds for Senate elections 2016 per DMA  
```{r}
senate_election_2016_plot <- ggplot(senate_election_2016, aes(x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = prop_spanish), color = "black", size = 0.1) +
  scale_fill_gradient(name = "Gradient value", low = "white", high = "darkblue", na.value = "grey") +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        rect = element_blank()) +
  labs(title = "Proportion of spanish adds for Senate elections 2016 per DMA") + 
  facet_wrap(~party) +
  coord_fixed(1.3)
```

```{r}
ggsave("visualizations/senate_election_2016_plot.png", plot = senate_election_2016_plot, height = 4, width = 6, dpi = 300)
```


Removing data
```{r}
rm(dma_and_spanish, wmp_senate_2016_v1_0, senate_election_2016)
```

### Loading 2016 (presidential) election results
```{r}
wmp_pres_2016_v1_1 <- read_dta("../2016 election data (presidential)/wmp-pres-2016-v1.1/wmp-pres-2016-v1.1.dta")
```

### Preparing for presidential 2016 data
```{r}
# Select only relevant columns
dma_and_spanish <- wmp_pres_2016_v1_1 %>% 
  select(dma, spanish, party)

# Proportion per dma and party
dma_and_spanish <- dma_and_spanish %>% 
  group_by(dma, party) %>%
  summarise(prop_spanish = mean(spanish))
```
### Merging map data and 2016 presidential election data
```{r}
presidential_election_2016 <- left_join(neil_map, dma_and_spanish, by = "dma")

presidential_election_2016 <- presidential_election_2016 %>% filter(party %in% c("DEMOCRAT", "REPUBLICAN"))

```

# Proportion of spanish adds for presidential elections 2016 per DMA 
```{r}
presidential_election_2016_plot <- ggplot(presidential_election_2016, aes(x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = prop_spanish), color = "black", size = 0.1) +
  scale_fill_gradient(name = "Gradient value", low = "white", high = "darkblue", na.value = "grey") +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        rect = element_blank()) +
  labs(title = "Proportion of spanish adds for presidential elections 2016 per DMA") + 
  facet_wrap(~party) +
  coord_fixed(1.3)
```

```{r}
ggsave("visualizations/presidential_election_2016_plot.png", plot = presidential_election_2016_plot, height = 4, width = 6, dpi = 300)
```


Remove data
```{r}
rm(presidential_election_2016, wmp_pres_2016_v1_1, dma_and_spanish)
```

### Loading 2018 election results
```{r}
wmp_house_2018_v1_0 <- read_dta("../2018 election data/wmp-house-2018-v1.0/wmp-house-2018-v1.0.dta")
wmp_senate_2018_v1_0 <- read_dta("../2018 election data/wmp-senate-2018-v1.0/wmp-senate-2018-v1.0.dta")
```

### Preparing for House 2018 data
```{r}
# Select only relevant columns
dma_and_spanish <- wmp_house_2018_v1_0 %>% 
  select(dma, spanish, party) %>% 
  filter(party %in% c("DEMOCRAT", "REPUBLICAN"))

# Proportion per dma and party
dma_and_spanish <- dma_and_spanish %>% 
  group_by(dma, party) %>%
  summarise(prop_spanish = mean(spanish))
```

### Merging map data and 2018 House election data
```{r}
house_election_2018 <- left_join(neil_map, dma_and_spanish, by = "dma")

house_election_2018 <- house_election_2018 %>% na.omit()
```
# Proportion of spanish adds for House elections 2018 per DMA
```{r}
house_election_2018_plot <- ggplot(house_election_2018, aes(x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = prop_spanish), color = "black", size = 0.1) +
  scale_fill_gradient(name = "Gradient value", low = "white", high = "darkblue", na.value = "grey") +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        rect = element_blank()) +
  labs(title = "Proportion of spanish adds for House elections 2018 per DMA") + 
  facet_wrap(~party) +
  coord_fixed(1.3)
```

```{r}
ggsave("visualizations/house_election_2018_plot.png", plot = house_election_2018_plot, height = 4, width = 6, dpi = 300)
```


Removing data
```{r}
rm(wmp_house_2018_v1_0, house_election_2018, dma_and_spanish)
```

### Preparing for Senate 2018 data
```{r}
# Select only relevant columns
dma_and_spanish <- wmp_senate_2018_v1_0 %>% 
  select(dma, spanish, party) %>% 
  filter(party %in% c("DEMOCRAT", "REPUBLICAN"))

# Proportion per dma and party
dma_and_spanish <- dma_and_spanish %>% 
  group_by(dma, party) %>%
  summarise(prop_spanish = mean(spanish))
```

### Merging map data and 2018 Senate election data
```{r}
senate_election_2018 <- left_join(neil_map, dma_and_spanish, by = "dma")

senate_election_2018 <- senate_election_2018 %>% na.omit()
```

# Proportion of spanish adds for Senate elections 2018 per DMA
```{r}
senate_election_2018_plot <- ggplot(senate_election_2018, aes(x = long, y = lat, group=group)) +
  geom_polygon(aes(fill = prop_spanish), color = "black", size = 0.1) +
  scale_fill_gradient(name = "Gradient value", low = "white", high = "darkblue", na.value = "grey") +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        rect = element_blank()) +
  labs(title = "Proportion of spanish adds for Senate elections 2018 per DMA") + 
  facet_wrap(~party) +
  coord_fixed(1.3)
```

```{r}
ggsave("visualizations/senate_election_2018_plot.png", plot = senate_election_2018_plot, height = 4, width = 6, dpi = 300)
```

Removing data
```{r}
rm(wmp_senate_2018_v1_0, senate_election_2018, dma_and_spanish)
```


